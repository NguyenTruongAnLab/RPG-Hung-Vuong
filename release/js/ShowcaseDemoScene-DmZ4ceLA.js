const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index-B5ATbyze.js","js/pixi-Drb_ZD99.js","js/animation-BOInWBL1.js","js/physics-ecXgi8kP.js"])))=>i.map(i=>d[i]);
import{G as y,b as g,C as P,_ as v}from"./pixi-Drb_ZD99.js";import{S as T,m as x,v as A,D as C}from"./index-B5ATbyze.js";import"./animation-BOInWBL1.js";import"./physics-ecXgi8kP.js";class z extends T{sceneManager;currentMonsterIndex=0;currentAnimation=null;currentElement="all";filteredMonsters=[];isFlipped=!1;currentScale=.5;isLoadingMonster=!1;pendingMonsterIndex=null;lastLoadCompleteTime=0;MIN_LOAD_DURATION=600;isAutoPlaying=!0;availableAnimations=[];currentAnimIndex=0;currentAnimationName="";animationPlayCount=0;animationTimer=0;autoPlayProgressText=null;autoPlayTimeout=null;monsterDisplay=null;infoPanel=null;controlPanel=null;debugAnimationText=null;scaleFactor=1;fontSize={header:28,subtitle:14,body:13,button:14,small:12,large:20};constructor(t,i){super(t),this.sceneManager=i,this.filteredMonsters=[...x.monsters]}async init(){console.log(`ShowcaseDemoScene init - screen size: ${this.app.screen.width}x${this.app.screen.height}`),this.calculateScaleFactors(),this.createBackground(),this.createHeader(),this.createElementFilter(),this.createMonsterDisplay(),this.createInfoPanel(),this.createControlPanel(),this.createNavigationButtons(),await this.loadMonster(this.currentMonsterIndex),window.addEventListener("resize",()=>this.handleResize())}calculateScaleFactors(){const t=this.app.screen.width,i=this.app.screen.height;this.scaleFactor=1;const s=i;this.fontSize={header:Math.max(32,Math.floor(s*.04)),subtitle:Math.max(14,Math.floor(s*.018)),body:Math.max(13,Math.floor(s*.016)),button:Math.max(14,Math.floor(s*.018)),small:Math.max(11,Math.floor(s*.013)),large:Math.max(20,Math.floor(s*.025))},console.log(`🎨 ShowcaseDemoScene responsive scaling: Screen ${t}x${i} | Fonts: header=${this.fontSize.header} body=${this.fontSize.body} button=${this.fontSize.button}`)}handleResize(){this.calculateScaleFactors(),this.removeChildren(),this.createBackground(),this.createHeader(),this.createElementFilter(),this.createMonsterDisplay(),this.createInfoPanel(),this.createControlPanel(),this.createNavigationButtons(),this.currentAnimation&&this.loadMonster(this.currentMonsterIndex)}createBackground(){const t=new y,i=this.app.screen.width,s=this.app.screen.height;t.rect(0,0,i,s),t.fill(1710638),this.addChild(t)}createHeader(){const t=this.app.screen.width;this.app.screen.height;const i=20*this.scaleFactor,s=15*this.scaleFactor,l=new g({text:"🐉 Thần Thú Showcase - 207 Characters 🐉",style:{fontSize:this.fontSize.header,fill:16766720,fontWeight:"bold",stroke:{color:0,width:Math.max(2,4*this.scaleFactor)}}});l.anchor.set(.5),l.position.set(t/2,s+l.height/2),this.addChild(l);const e=new g({text:"Xem trước toàn bộ 207 Thần Thú với tất cả animations | Auto-play đã bật",style:{fontSize:this.fontSize.subtitle,fill:13421772,fontStyle:"italic",align:"center"}});e.anchor.set(.5,0),e.position.set(t/2,s+l.height+5*this.scaleFactor),this.addChild(e);const n=this.createButton("← Quay lại",i,i,()=>{this.goBack()},5592405,100*this.scaleFactor);this.addChild(n)}createElementFilter(){const t=this.app.screen.width,i=this.app.screen.height,s=["all","kim","moc","thuy","hoa","tho"],l=["Tất cả",A.elements.kim,A.elements.moc,A.elements.thuy,A.elements.hoa,A.elements.tho],e=[8947848,12632256,5025616,2201331,16733986,7951688],n=100,o=10,h=8,c=t-o*2,a=Math.max(40,i*.06),d=(c-h*(s.length-1))/s.length,r=Math.floor(8),m=n+10;s.forEach((f,u)=>{const w=f===this.currentElement,p=new y;p.roundRect(0,0,d,a,r),p.fill(w?e[u]:3355443),p.position.set(o+u*(d+h),m),p.interactive=!0,p.cursor="pointer",p.eventMode="static",p.on("pointerdown",()=>{this.currentElement=f,this.filterByElement(f)});const b=new g({text:l[u],style:{fontSize:this.fontSize.button,fill:16777215,align:"center",fontWeight:"bold"}});b.anchor.set(.5),b.position.set(d/2,a/2),p.addChild(b),this.addChild(p)})}createMonsterDisplay(){const t=this.app.screen.width,i=this.app.screen.height,s=140,e=i-s-60,n=t*.58,o=e*.95,h=10,c=s+(e-o)/2;this.monsterDisplay=new P,this.monsterDisplay.position.set(h,c),this.addChild(this.monsterDisplay);const a=new y;a.roundRect(0,0,n,o,15),a.fill({color:2963272,alpha:.8}),a.stroke({color:4871528,width:2}),this.monsterDisplay.addChild(a),console.log(`✅ Monster display: ${n}x${o} at (${h}, ${c})`)}createInfoPanel(){const t=this.app.screen.width,i=this.app.screen.height,s=140,e=i-s-60,n=t*.4-10,o=e*.5-5,h=t*.6+5,c=s+5,a=12,d=10;this.infoPanel=new P,this.infoPanel.position.set(h,c),this.addChild(this.infoPanel);const r=new y;r.roundRect(0,0,n,o,d),r.fill({color:2763322,alpha:.9}),r.stroke({color:4871528,width:2}),this.infoPanel.addChild(r);const m=new g({text:"📋 Thông tin",style:{fontSize:this.fontSize.large,fill:16766720,fontWeight:"bold"}});m.position.set(a,a),this.infoPanel.addChild(m),console.log(`✅ Info panel: ${n}x${o} at (${h}, ${c})`)}createControlPanel(){const t=this.app.screen.width,i=this.app.screen.height,s=140,e=i-s-60,n=t*.4-10,o=e*.45-5,h=t*.6+5,c=s+e*.5+10,a=12,d=10;this.controlPanel=new P,this.controlPanel.position.set(h,c),this.addChild(this.controlPanel);const r=new y;r.roundRect(0,0,n,o,d),r.fill({color:2763322,alpha:.9}),r.stroke({color:4871528,width:2}),this.controlPanel.addChild(r);const m=new g({text:"⚙️ Điều khiển",style:{fontSize:this.fontSize.large,fill:16766720,fontWeight:"bold"}});m.position.set(a,a),this.controlPanel.addChild(m);const f=n-a*2,u=this.createButton(this.isAutoPlaying?"⏸️ Dừng Auto":"▶️ Auto",a,a,()=>this.toggleAutoPlay(),this.isAutoPlaying?16750592:5025616,f);u.name="auto-play-btn",this.controlPanel.addChild(u),this.autoPlayProgressText=new g({text:"Anim 1/5",style:{fontSize:this.fontSize.body,fill:16766720,align:"center"}}),this.autoPlayProgressText.anchor.set(.5,0),this.autoPlayProgressText.position.set(f/2+a,a+50),this.controlPanel.addChild(this.autoPlayProgressText),console.log(`✅ Control panel: ${n}x${o} at (${h}, ${c})`)}createNavigationButtons(){const t=this.app.screen.width,i=this.app.screen.height,s=15,l=Math.max(45,i*.06),e=i-l-5,n=(t-s*2)/3,o=10,h=this.createButton("◀ Trước",s,e,()=>{this.previousMonster()},5025616,(n-o*.5)/2);this.addChild(h);const c=this.createButton("📊 Thông tin chi tiết",s+(n-o*.5)/2+o,e,()=>{console.log("Show detailed info")},2201331,(n-o*.5)/2);this.addChild(c);const a=this.createButton("Sau ▶",s+n+o,e,()=>{this.nextMonster()},5025616,(n-o*.5)/2);this.addChild(a),console.log(`✅ Navigation buttons at Y=${e}, height=${l}`)}createButton(t,i,s,l,e=5025616,n=100){const o=new P;o.position.set(i,s);const h=Math.max(40,this.app.screen.height*.05),c=10,a=new y;a.roundRect(0,0,n,h,c),a.fill(e),a.interactive=!0,a.eventMode="static",o.addChild(a);const d=new g({text:t,style:{fontSize:Math.max(12,this.fontSize.button),fill:16777215,fontWeight:"bold",wordWrap:!0,wordWrapWidth:n-10}});return d.anchor.set(.5),d.position.set(n/2,h/2),o.addChild(d),o.interactive=!0,o.eventMode="static",o.cursor="pointer",o.on("pointerdown",l),o.on("pointerover",()=>{a.tint=13421772}),o.on("pointerout",()=>{a.tint=16777215}),o}loadMonster(t){if(t<0||t>=this.filteredMonsters.length)return Promise.resolve();if(this.isLoadingMonster)return this.pendingMonsterIndex=t,Promise.resolve();const i=Date.now()-this.lastLoadCompleteTime;if(i<this.MIN_LOAD_DURATION){this.pendingMonsterIndex=t;const e=this.MIN_LOAD_DURATION-i;return setTimeout(()=>{this.pendingMonsterIndex===t&&this.loadMonster(t)},e),Promise.resolve()}this.isLoadingMonster=!0,this.pendingMonsterIndex=null,this.currentMonsterIndex=t;const s=this.filteredMonsters[t];if(this.autoPlayTimeout&&(clearTimeout(this.autoPlayTimeout),this.autoPlayTimeout=null),this.currentAnimation){try{const e=this.currentAnimation.getDisplay();if(e){try{e.animation&&e.animation.stop()}catch{}e.parent&&e.parent.removeChild(e),e.visible=!1,e.renderable=!1}const n=this.currentAnimation;setTimeout(()=>{try{n.destroy()}catch(o){console.warn("Error destroying animation:",o)}},100)}catch(e){console.warn("Error cleaning up old display:",e)}this.currentAnimation=null}if(this.monsterDisplay&&this.monsterDisplay.children.length>1){const e=[];for(let n=1;n<this.monsterDisplay.children.length;n++){const o=this.monsterDisplay.children[n];o.label!=="loading"&&e.push(o)}e.forEach(n=>{try{this.monsterDisplay.removeChild(n),n.destroy&&n.destroy({children:!0,texture:!1})}catch{}})}const l=new g({text:"Đang tải...",style:{fontSize:this.fontSize.large,fill:16777215}});return l.anchor.set(.5),l.label="loading",this.monsterDisplay?.addChild(l),(async()=>{try{this.currentAnimation=new C(this.app),await this.currentAnimation.loadCharacter(s.assetName);const e=this.currentAnimation.getDisplay();if(e&&this.monsterDisplay){e.parent&&e.parent!==this.monsterDisplay&&e.parent.removeChild(e),e.visible=!0,e.alpha=1;const n=this.app.screen.width*.58,o=(this.app.screen.height-200)*.95,h=o*.2;e.position.set(n/2,o/2+h),e.scale.set(.3),this.isFlipped&&this.currentAnimation.setFlip(!0),this.currentAnimation.play("Idle"),await new Promise(c=>setTimeout(()=>{this.monsterDisplay&&e.parent!==this.monsterDisplay&&this.monsterDisplay.addChild(e),c(void 0)},32)),await new Promise(c=>setTimeout(()=>{try{const a=e.getLocalBounds(),d=a.width,r=a.height,m=n*.7,f=o*.6;let u=1;d>0&&(u=Math.min(u,m/d)),r>0&&(u=Math.min(u,f/r)),u>0&&isFinite(u)&&e.scale.set(u)}catch(a){console.warn("Could not calculate character bounds:",a)}c(void 0)},50)),this.createDebugAnimationText(),this.setupAnimationEventListener(e)}this.updateInfoPanel(s),this.availableAnimations=this.currentAnimation.listAnimations(),this.currentAnimIndex=0,this.currentAnimationName=this.availableAnimations.length>0?this.availableAnimations[0]:"",this.animationPlayCount=0,this.animationTimer=0,this.updateAnimationButtons(),this.updateProgressText(),this.isAutoPlaying&&this.availableAnimations.length>0&&this.playNextAnimation()}catch(e){console.error(`Failed to load monster ${s.assetName}:`,e);const n=new g({text:`❌ Lỗi: ${s.assetName}`,style:{fontSize:Math.floor(16*this.scaleFactor),fill:16733525}});n.anchor.set(.5),this.monsterDisplay?.addChild(n)}finally{const e=this.monsterDisplay?.children.find(n=>n.label==="loading");if(e&&this.monsterDisplay&&this.monsterDisplay.removeChild(e),this.lastLoadCompleteTime=Date.now(),this.isLoadingMonster=!1,this.pendingMonsterIndex!==null){const n=this.pendingMonsterIndex;this.pendingMonsterIndex=null,this.loadMonster(n)}}})()}setupAnimationEventListener(t){}createDebugAnimationText(){this.debugAnimationText&&this.monsterDisplay&&(this.monsterDisplay.removeChild(this.debugAnimationText),this.debugAnimationText=null);const t=this.app.screen.width*.58,i=(this.app.screen.height-200)*.95;this.debugAnimationText=new g({text:`🎬 ${this.currentAnimationName||"None"}`,style:{fontSize:Math.max(12,this.fontSize.small),fill:16766720,align:"center",fontFamily:"Arial"}}),this.debugAnimationText.anchor.set(.5,0),this.debugAnimationText.position.set(t/2,i-30),this.monsterDisplay?.addChild(this.debugAnimationText)}updateInfoPanel(t){if(!this.infoPanel)return;for(;this.infoPanel.children.length>1;)this.infoPanel.removeChild(this.infoPanel.children[1]);const i=10*this.scaleFactor,l=this.infoPanel.children[0].width,e=new g({text:`${t.name} (${t.englishName})
Ngũ Hành: ${A.elements[t.element]} | Tier: ${"★".repeat(t.tier)}
HP: ${t.stats.hp} | ATK: ${t.stats.attack} | DEF: ${t.stats.defense} | SPD: ${t.stats.speed}
${t.description}`,style:{fontSize:this.fontSize.body,fill:16777215,wordWrap:!0,wordWrapWidth:l-i*2}});e.position.set(i,i),this.infoPanel.addChild(e)}updateAnimationButtons(){if(!this.currentAnimation||!this.controlPanel)return;this.controlPanel.children.filter(r=>r.name==="anim-btn").forEach(r=>this.controlPanel?.removeChild(r));const i=this.currentAnimation.listAnimations();if(i.length===0)return;const s=12,e=this.app.screen.width*.4-10-s*2,n=8,h=35+10;let c=s+80;const a=4;Math.ceil(i.length/a);const d=(e-n*(a-1))/a;i.forEach((r,m)=>{const f=Math.floor(m/a),u=m%a,w=r===this.currentAnimationName,p=s+u*(d+n),b=c+f*h,M=this.createButton(r,p,b,()=>{this.currentAnimationName=r,this.currentAnimation&&(this.currentAnimation.play(r,1),this.updateProgressText()),this.updateAnimationButtons()},w?16766720:10233776,d);M.name="anim-btn",this.controlPanel?.addChild(M)})}toggleAutoPlay(){this.isAutoPlaying=!this.isAutoPlaying,this.isAutoPlaying?(this.animationPlayCount=0,this.animationTimer=0,console.log("🎬 Auto-play enabled")):(this.currentAnimation&&this.currentAnimation.play("Idle"),console.log("⏸️ Auto-play paused")),this.updateAutoPlayButton()}updateAutoPlayButton(){if(!this.controlPanel)return;const t=this.controlPanel.children.find(h=>h.name==="auto-play-btn");if(!t)return;const i=t.children[0],s=t.children[1],e=this.controlPanel.children[0].width,n=Math.floor(35*this.scaleFactor),o=Math.floor(8*this.scaleFactor);i.clear(),i.roundRect(0,0,e*.4,n,o),i.fill(this.isAutoPlaying?16750592:5025616),s.text=this.isAutoPlaying?"⏸️ Dừng":"▶️ Auto"}playNextAnimation(){if(!this.currentAnimation||this.availableAnimations.length===0)return;const t=this.availableAnimations[this.currentAnimIndex];this.currentAnimation.getDisplay(),this.currentAnimation.play(t,1),this.animationPlayCount++,this.updateProgressText();const i=this.estimateAnimationDuration(t);this.autoPlayTimeout&&clearTimeout(this.autoPlayTimeout),this.autoPlayTimeout=window.setTimeout(()=>{this.isAutoPlaying&&this.availableAnimations.length>0&&(this.animationPlayCount>=2?(this.animationPlayCount=0,this.currentAnimIndex++,this.currentAnimIndex>=this.availableAnimations.length&&(this.currentAnimIndex=0),this.playNextAnimation()):this.playNextAnimation())},i)}estimateAnimationDuration(t){const i=t.toLowerCase();return i.includes("attack")||i.includes("damage")?1500:i.includes("walk")||i.includes("run")?1e3:i.includes("idle")||i.includes("stand")||i.includes("skill")||i.includes("ability")?2e3:1500}updateProgressText(){if(!this.autoPlayProgressText||this.availableAnimations.length===0)return;const t=this.availableAnimations[this.currentAnimIndex],i=t.length>8?t.substring(0,8)+"..":t;this.currentAnimationName=t,this.autoPlayProgressText.text=`${i} ${this.currentAnimIndex+1}/${this.availableAnimations.length}(${this.animationPlayCount+1}/2)`,this.debugAnimationText&&(this.debugAnimationText.text=`🎬 ${t}`)}flipMonster(){this.isFlipped=!this.isFlipped,this.currentAnimation&&this.currentAnimation.setFlip(this.isFlipped)}scaleMonster(t){this.currentScale=t,this.currentAnimation&&this.currentAnimation.setScale(t)}filterByElement(t){t==="all"?this.filteredMonsters=[...x.monsters]:this.filteredMonsters=x.monsters.filter(i=>i.element===t),this.currentMonsterIndex=0,this.loadMonster(0),this.children.filter(i=>i.name==="element-filter").forEach(i=>this.removeChild(i)),this.createElementFilter()}previousMonster(){const t=this.currentMonsterIndex-1;t>=0?this.loadMonster(t):this.loadMonster(this.filteredMonsters.length-1)}nextMonster(){const t=this.currentMonsterIndex+1;t<this.filteredMonsters.length?this.loadMonster(t):this.loadMonster(0)}async goBack(){const{CharacterSelectionScene:t}=await v(async()=>{const{CharacterSelectionScene:s}=await import("./index-B5ATbyze.js").then(l=>l.C);return{CharacterSelectionScene:s}},__vite__mapDeps([0,1,2,3])),i=new t(this.app,this.sceneManager);await this.sceneManager.switchTo(i)}update(t){}destroy(){this.autoPlayTimeout&&(clearTimeout(this.autoPlayTimeout),this.autoPlayTimeout=null),window.removeEventListener("resize",()=>this.handleResize()),this.currentAnimation&&(this.currentAnimation.destroy(),this.currentAnimation=null),this.removeAllListeners(),P.prototype.destroy.call(this)}}export{z as ShowcaseDemoScene};
